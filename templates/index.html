{% extends "layout.html" %}

{% block title %}
    Form
{% endblock %}

{% block main %}
    <h1>OHHC Match Report Form</h1>
    <p>Use this form to update the Club Statistics database. Only click submit once you've double checked all details are correct.</p>

    {% if error %}<div class="error">{{ error }}</div>{% endif %}

    <hr>

    <div>
        <p>If match was not played due to either team forfeting, please submit walkover form instead</p>
        <a href="{{ url_for('walkover') }}">
            <button type="button">Go to walkover form</button>
        </a>
    </div>

    <hr>

    <form action="/" method="post">
        <h2>Match Details</h2>

        <div class="form-field">
            <label for="match_date">Match Date</label>
            <input type="date"
            id="match_date"
            name="match_date"
            min="2024-01-01"
            required
            value="{{ form.match_date }}">
        </div>

        <div class="form-field">
            <label for="team">Team</label>
            <select id="team" name="team" required>
                <option value="" disabled hidden
                    {% if not form.team %}selected{% endif %}>
                    M1 W1 M2 W2 etc.
                </option>
                {% for TEAM in TEAMS %}
                    <option value="{{ TEAM }}" {% if form.team == TEAM %}selected{% endif %}>{{ TEAM }}</option>
                {% endfor %}
            </select>
        </div>

        <div class="form-field">
            <label for="opponent">Opponent</label>
            <input type="text"
            id="opponent"
            name="opponent"
            placeholder="St Albans M2"
            required
            value="{{ form.opponent }}"
            aria-describedby="opponent_help">
            <small id="opponent_help" class="form-help">Please enter team name exactly as it appears on GMS or the league website</small>
        </div>

        <div class="form-field">
            <label for="venue">Venue</label>
            <select id="venue" name="venue" required>
                <option value="" disabled hidden
                    {% if not form.venue %}selected{% endif %}>
                    Home / Away
                </option>
                <option value="Home" {% if form.venue == "Home" %}selected{% endif %}>Home</option>
                <option value="Away" {% if form.venue == "Away" %}selected{% endif %}>Away</option>
            </select>
        </div>

        <div class="form-field">
            <label for="scored">Goals Scored</label>
            <input type="number"
            id="scored"
            name="goals_scored"
            placeholder="e.g. 2"
            min="0"
            required
            value="{{ form.goals_scored }}">
        </div>

        <div class="form-field">
            <label for="conceded">Goals Conceded</label>
            <input type="number"
            id="conceded"
            name="goals_conceded"
            placeholder="e.g. 1"
            min="0"
            required
            value="{{ form.goals_conceded }}">
        </div>

        <hr>

        <h2>Players & Goals</h2>

        <div class="form-field">
            <table id="players-table">
                <tr>
                    <th>Player Name</th>
                    <th>Goals</th>
                </tr>

                {% for i in range(1, MAX_PLAYERS + 1) %}
                <tr>
                    <td>
                        <input class="player-input"
                        type="text"
                        name="player_{{ i }}"
                        autocomplete="off"
                        value="{{ form['player_' ~ i] or '' }}"
                        data-row="{{ i }}"
                        {% if i <= MIN_PLAYERS %} required {% endif %}>

                        <!-- Hidden field to store player_id -->
                        <input class="player_id_field"
                        type="hidden"
                        name="player_id_{{ i }}"
                        {% if form['player_id_' ~ i] %}value="{{ form['player_id_' ~ i] }}"{% endif %}>

                        <!-- this div lets JS show a dropdown exactly under the correct field -->
                        <div class="autocomplete-results" id="results-{{ i }}"></div>
                    </td>

                    <td>
                        <input type="number"
                        name="goals_{{ i }}"
                        min="0"
                        value="{{ form['goals_' ~ i] or '0' }}"
                        {% if i <= MIN_PLAYERS %} required {% endif %}>
                    </td>
                </tr>
                {% endfor %}
            </table>
        </div>

        <div class="form-field">
            <button type="submit">Submit</button>
        </div>
    </form>
{% endblock %}